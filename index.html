<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClubTake - ホーム</title>
    <!-- Tailwind CSS を読み込みます -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts（明朝体とサンセリフ体）を読み込みます -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- CSSファイルを読み込みます -->
    <link rel="stylesheet" href="css/style.css">

    <script>
        // Tailwind CSSのカスタム設定
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'serif-jp': ['"Noto Serif JP"', 'serif']
                    },
                    colors: {
                        // ワイヤーフレームで指定したアクセント色（ゴールド）
                        'brand-gold': '#C0A16B',
                        'brand-gold-light': '#DBC18B', // 少し明るく
                        'brand-gold-dark': '#A0814B'  // 少し暗く
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-black text-gray-200 font-sans">
    <header class="sticky top-0 z-50 w-full bg-black bg-opacity-80 backdrop-blur-sm shadow-lg border-b border-gray-800">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <!-- ロゴ -->
            <div class="text-2xl font-serif-jp font-bold">
                <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                    ClubTake
                </span>
            </div>
            <!-- ナビゲーション（PC用） -->
            <div class="flex space-x-4 md:space-x-8 text-sm tracking-wide">
                <a href="index.html" class="text-white hover:text-brand-gold transition-colors duration-300">Home</a>
                <a href="login.html" class="text-gray-300 hover:text-brand-gold transition-colors duration-300">Members</a>
                <!-- ▼▼▼▼▼▼▼▼▼▼ 変更点 ▼▼▼▼▼▼▼▼▼▼ -->
                <a href="feedback.html" class="text-gray-300 hover:text-brand-gold transition-colors duration-300">Feedback</a>
                <!-- ▲▲▲▲▲▲▲▲▲▲ 変更点 ▲▲▲▲▲▲▲▲▲▲ -->
            </div>
        </nav>
    </header>

    <!-- メインコンテンツ -->
    <main>

        <!-- 1. トップページ: セクション1 (ファーストビュー) -->
        <section class="h-screen min-h-[700px] relative flex items-center justify-center text-center text-white overflow-hidden">
            <!-- ... (省略) ... -->
            <div class="relative z-20 p-8 space-y-4">
                <h1 class="text-4xl md:text-6xl font-serif-jp font-bold hero-text-1" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.7);">
                    ようこそ、ClubTakeへ。
                </h1>
                <p class="text-xl md:text-3xl font-serif-jp hero-text-2" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">
                    理知が交差し、中立性が守られる場所。
                </p>
            </div>
        </section>

        <!-- 1. トップページ: セクション2 (ご挨拶) -->
        <section class="py-20 md:py-32 bg-black fade-in"> <!-- fade-inクラスを追加 -->
            <div class="container mx-auto px-6">
                <div class="max-w-3xl mx-auto text-center md:text-left">
                    <h2 class="text-3xl md:text-4xl font-serif-jp mb-6">
                        <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                            叡信の原則
                        </span>
                    </h2>
                    <p class="text-base leading-relaxed text-gray-300">
                        CLUB Takeは、高度な専門知識を持つ人々が、社会的な立場を超えて集う場所です。
                        当クラブへの入会は過去の実績ではなく、「クラブのルールを尊重し、真のプロフェッショナルとして行動する」という決意によってのみ決まります。
                        ここでは、あらゆる敵対行為が禁じられ、絶対的な中立性が保障されます。外部の混乱から隔離されたこの空間で、信頼できる情報交換と協力のひとときをお過ごしください。
                    </p>
                </div>
            </div>
        </section>

        <!-- 1. トップページ: セクション3 (クラブの特徴) -->
        <section class="py-20 md:py-32 bg-black fade-in"> <!-- fade-inクラスを追加 -->
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-serif-jp text-center mb-16">
                    <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                        ClubTakeの神髄
                    </span>
                </h2>
                <div class="grid md:grid-cols-3 gap-10">
                    <!-- 特徴カード 1: 空間 -->
                    <div class="bg-black border border-gray-800 rounded-lg shadow-xl overflow-hidden group transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                        <div class="p-8">
                            <h3 class="text-2xl font-serif-jp mb-3">
                                <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                                    洗練された静謐
                                </span>
                            </h3>
                            <p class="text-sm text-gray-300 leading-relaxed">
                                外部の混乱から隔離された、絶対的な中立空間。ここでは、ただ知的な交流だけが許されます。
                            </p>
                        </div>
                    </div>
                    <!-- 特徴カード 2: サービス -->
                    <div class="bg-black border border-gray-800 rounded-lg shadow-xl overflow-hidden group transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                        <div class="p-8">
                            <h3 class="text-2xl font-serif-jp mb-3">
                                <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                                    絶対的中立性
                                </span>
                            </h3>
                            <p class="text-sm text-gray-300 leading-relaxed">
                                利害が対立する組織のメンバーであっても、ここでは互いへの敬意と中立を維持することが求められます。
                            </p>
                        </div>
                    </div>
                    <!-- 特徴カード 3: 伝統 -->
                    <div class="bg-black border border-gray-800 rounded-lg shadow-xl overflow-hidden group transition-all duration-300 hover:shadow-2xl hover:-translate-y-2">
                        <div class="p-8">
                            <h3 class="text-2xl font-serif-jp mb-3">
                                <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                                    独立の誓い
                                </span>
                            </h3>
                            <p class="text-sm text-gray-300 leading-relaxed">
                                2025年7月9日。私たちは社会的な因縁を脇に置き、クラブの「叡信」の原則にのみ従うことを誓いました。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 1. トップページ: セクション5 (お知らせ) -->
        <section id="news-section" class="py-20 md:py-32 bg-black fade-in">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl md:text-4xl font-serif-jp text-center mb-16">
                    <span class="bg-gradient-to-b from-brand-gold-light via-brand-gold to-brand-gold-dark bg-clip-text text-transparent drop-shadow-[0_2px_8px_rgba(192,161,107,0.4)]">
                        お知らせ
                    </span>
                </h2>
                
                <!-- 読み込み中メッセージ -->
                <div id="news-loading-message" class="text-center text-gray-400">
                    お知らせを読み込んでいます...
                </div>
                
                <!-- お知らせ一覧が挿入されるコンテナ -->
                <div id="news-list-container" class="max-w-3xl mx-auto space-y-6">
                    <!-- ここにJavaScriptによってお知らせが挿入されます -->
                </div>
            </div>
        </section>
        <!-- ▲▲▲▲▲▲▲▲▲▲ 変更点 ▲▲▲▲▲▲▲▲▲▲ -->

    </main>

    <!-- 共通フッター -->
    <footer class="py-16 bg-black border-t border-gray-800">
        <!-- ... (省略) ... -->
        <div class="container mx-auto px-6 text-center text-gray-400">
            <!-- ... (省略) ... -->
            <p class="text-xs text-gray-500 mt-8">
                &copy; 2025 ClubTake. All Rights Reserved.
            </p>
        </div>
    </footer>

    <!-- アニメーションのコードを外部ファイル(js/main.js)から読み込みます -->
    <script src="js/main.js" defer></script>

    <!-- ▼▼▼▼▼▼▼▼▼▼ 変更点（Firebase読み込みスクリプトの追加） ▼▼▼▼▼▼▼▼▼▼ -->
    <script type="module">
        // Firebaseの基本的な機能（App）を読み込みます
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // Realtime Database の機能を読み込みます
        import { getDatabase, ref, query, orderByChild, limitToLast, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // あなたの「本物の」設定情報を貼り付けます
        const firebaseConfig = {
          apiKey: "AIzaSyDgpAbNmhRGgxiJusSqo1mG1wJbX4TS0uI",
          authDomain: "clubtake-257af.firebaseapp.com",
          projectId: "clubtake-257af",
          storageBucket: "clubtake-257af.firebasestorage.app",
          messagingSenderId: "871043706318",
          appId: "1:871043706318:web:19e8cfb02823003e518f9f",
          measurementId: "G-NVXMV89KHP"
        };
        
        // Realtime Database の URL を config に追加します
        firebaseConfig.databaseURL = "https://clubtake-257af-default-rtdb.firebaseio.com/";

        let app, db;
        const listContainer = document.getElementById('news-list-container');
        const loadingMessage = document.getElementById('news-loading-message');

        try {
            // Firebaseを初期化します
            app = initializeApp(firebaseConfig);
            // Realtime Database を初期化します
            db = getDatabase(app);
            
            // お知らせの読み込みを開始します
            loadPublicNews();

        } catch (error) {
            console.error("Firebase initialization error:", error);
            if(loadingMessage) loadingMessage.textContent = "システムの初期化に失敗しました。";
        }

        /**
         * 一般公開用お知らせを読み込んで表示する関数
         */
        function loadPublicNews() {
            const newsRef = ref(db, 'public_news');
            
            // createdAt（作成日時）で並び替え、最新の3件を取得するクエリ
            // （Realtime DBは昇順しかサポートしないため、limitToLast(3) で「最後（最新）の3件」を取得します）
            const newsQuery = query(newsRef, orderByChild('createdAt'), limitToLast(3));

            // onValue を使って、データベースの変更をリアルタイムで監視します
            onValue(newsQuery, (snapshot) => {
                if (snapshot.exists()) {
                    const news = snapshot.val();
                    
                    // 読み込みメッセージを非表示に
                    if(loadingMessage) loadingMessage.style.display = 'none';
                    // 既存のリストをクリア
                    listContainer.innerHTML = '';
                    
                    // データベースから取得したデータを配列に変換し、「新しい順」に並び替える
                    const newsArray = Object.entries(news)
                        .map(([key, value]) => ({ key, ...value })) // オブジェクトを配列に
                        .sort((a, b) => b.createdAt - a.createdAt); // createdAt の降順（新しい順）でソート
                    
                    
                    // 並び替えた配列を使って、お知らせのHTMLを組み立てる
                    newsArray.forEach(post => {
                        
                        // タイムスタンプ（数字）を「YYYY年MM月DD日」の形式に変換
                        const date = new Date(post.createdAt);
                        const formattedDate = `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                        
                        // XSS（クロスサイトスクリプティング）対策：
                        // ユーザーが入力した可能性のあるテキストを安全に表示するための関数
                        const escapeHTML = (str) => {
                             if (typeof str !== 'string') return '';
                             return str.replace(/[&<>"']/g, (match) => {
                                return {
                                  '&': '&amp;',
                                  '<': '&lt;',
                                  '>': '&gt;',
                                  '"': '&quot;',
                                  "'": '&#39;'
                                }[match];
                            });
                        }
                        
                        // カテゴリに応じた色を決定
                        const categoryClass = post.category === '催事' ? 'text-brand-gold-light' : 'text-gray-400';

                        const newsItem = document.createElement('a');
                        
                        // ▼▼▼▼▼▼▼▼▼▼ 変更点 ▼▼▼▼▼▼▼▼▼▼
                        // href="#" を、詳細ページへのリンク（?id=...）に変更します
                        newsItem.href = `news-detail.html?id=${escapeHTML(post.key)}`; 
                        // ▲▲▲▲▲▲▲▲▲▲ 変更点 ▲▲▲▲▲▲▲▲▲▲
                        
                        newsItem.className = "block p-6 bg-black border border-gray-800 rounded-lg shadow-lg hover:bg-gray-900 transition-all duration-300 group";
                        
                        newsItem.innerHTML = `
                            <p class="text-sm text-gray-500 mb-1">
                                <time>${formattedDate}</time> | <span class="font-medium ${categoryClass}">${escapeHTML(post.category)}</span>
                            </p>
                            <h3 class="text-lg font-serif-jp text-gray-200 group-hover:text-brand-gold-light transition-colors duration-300">
                                ${escapeHTML(post.title)}
                            </h3>
                        `;
                        
                        listContainer.appendChild(newsItem);
                    });

                } else {
                    // お知らせが一件もない場合
                    if(loadingMessage) loadingMessage.textContent = '現在、お知らせはありません。';
                }
            }, (error) => {
                console.error("お知らせの読み込み失敗:", error);
                if(loadingMessage) loadingMessage.textContent = 'お知らせの読み込みに失敗しました。';
            });
        }
    </script>
    <!-- ▲▲▲▲▲▲▲▲▲▲ 変更点 ▲▲▲▲▲▲▲▲▲▲ -->

</body>
</html>
